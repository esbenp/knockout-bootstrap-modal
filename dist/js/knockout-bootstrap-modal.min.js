!function(t,e){"function"==typeof define&&define.amd?define(["jquery","knockout","bootstrap","text!knockout-bootstrap-modal-html","require","knockout-undomanager","knockout-mapping"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("knockout"),require("bootstrap"),require("text!knockout-bootstrap-modal-html"),require("require"),require("knockout-undomanager"),require("knockout-mapping")):t.KnockoutBootstrapModal=e(t.jQuery,t.ko,t.jQuery,t.KnockoutBootstrapModalHtml,t.jQuery,t.knockoutUndoManager,t.ko.mapping)}(this,function(t,e,n,a,o,i,r){if("undefined"==typeof s)var s={};!function(e){"use strict";var n=function(t,n){this.instance=t,this.initialize(n),this.initializeModal();new e.Template(this.instance)};n.prototype.createHidingPromise=function(){var e=this,n=t.Deferred();return t.when(n).then(function(){e.instance.hide()}),n},n.prototype.createContainerFromHtml=function(e){var n=t(e),a=t(this.instance.settings.appendContainerTo);if(0===a.length)throw Error("Knockout-bootstrap-modal: Could not find an element with selector '"+this.instance.settings.appendContainerTo+"' to append the modal container to.");return n.appendTo(a),n},n.prototype.evaluateContainerInput=function(t){return l(t)},n.prototype.initialize=function(t){if("undefined"!=typeof t)return this.setContainer(t);if("undefined"!=typeof a)return this.setContainer(this.createContainerFromHtml(a));throw Error("Knockout-bootstrap-modal: No valid container was given.")},n.prototype.initializeModal=function(){this.instance.container.modal({show:!1})},n.prototype.onModalHide=function(t){if(t.target!==this.instance.container[0])return!1;if(this.instance.variables.saving===!1&&void 0!==this.instance.undoRedoStack)for(var e=this.instance.undoRedoStack.undoCommand;e.enabled();)e.execute()},n.prototype.onModalHidden=function(){p(this.instance.variables.callbacks.hidden,this.instance.container)},n.prototype.setContainer=function(t){var t=this.evaluateContainerInput(t);if(0===t.length)throw Error("Knockout-bootstrap-modal: Could not find container with selector "+t);return this.instance.container=t,t},n.prototype.setupEvents=function(){this.instance.container.on("hide.bs.modal",this.onModalHide.bind(this)),this.instance.container.on("hidden.bs.modal",this.onModalHidden.bind(this))},e.Factory=n}(s),function(n){"use strict";var a=function(e,o,i){this.container,this.settings=t.extend({},a.DEFAULTS,o||{}),this.variables={},l.call(this),t.extend(this.variables.callbacks,i),this.factory=new n.Factory(this,e)};a.DEFAULTS={appendContainerTo:"body",body:".modal-body"},a.VARIABLE_DEFAULTS={callbacks:{},closeClick:null,saveClick:null,saving:!1,alertExternalTemplate:!1,alertTemplate:"<p data-bind='text: text'></p>",promptExternalTemplate:!1,promptInputTemplate:"<input type='text' data-bind='value: prompt'>",promptTextTemplate:"<p data-bind='text: text'></p>",templateIsExternal:!1,template:"<div></div>",templateVariables:{closeButton:!0,closeButtonLabel:"Cancel",closeButtonLabelPrompt:"Cancel",closeButtonLabelConfirm:"Cancel",closeCross:!0,footer:!0,header:!0,large:!1,saveButton:!0,saveButtonLabel:"Save changes",saveButtonLabelAlert:"Ok",saveButtonLabelConfirm:"Confirm",saveButtonLabelPrompt:"Save changes",title:!1},viewmodel:{}};var o=function(){return p(this.variables.callbacks.close),this.hide(),!0},s=function(){var e=this;this.variables.saving=!0;var n=this.factory.createHidingPromise();return t.when(n).then(function(){e.variables.saving=!1}),u(this.variables.callbacks.save)?this.variables.callbacks.save.call(this,n,this.variables.viewmodel):n.resolve(!0),!0},l=function(){var e=t.extend(!0,{},a.VARIABLE_DEFAULTS,{closeClick:o.bind(this),saveClick:s.bind(this)});r.fromJS(e,{copy:["alertTemplate","alertExternalTemplate","promptExternalTemplate","promptInputTemplate","promptTextTemplate","saving","templateIsExternal"]},this.variables)};a.prototype.alert=function(t){return this.viewmodel({text:t}),this.template(this.variables.alertTemplate,this.variables.alertExternalTemplate),this.header(!1),this.closeButton(!1),this.saveButtonLabel(this.variables.templateVariables.saveButtonLabelAlert()),this},a.prototype.close=function(t){return this.variables.callbacks.close=t,this},a.prototype.closeButton=function(t){return this.variables.templateVariables.closeButton(t),this},a.prototype.closeButtonLabel=function(t){return this.variables.templateVariables.closeButtonLabel(t),this},a.prototype.closeCross=function(t){return this.variables.templateVariables.closeCross(t),this},a.prototype.confirm=function(t){return this.alert(t),this.closeButton(!0),this.closeButtonLabel(this.variables.templateVariables.closeButtonLabelConfirm()),this.saveButtonLabel(this.variables.templateVariables.saveButtonLabelConfirm()),this},a.prototype.footer=function(t){return this.variables.templateVariables.footer(t),this},a.prototype.header=function(t){return this.variables.templateVariables.header(t),this},a.prototype.hide=function(){return this.container.modal("hide"),this},a.prototype.large=function(t){return"undefined"==typeof t&&(t=!0),this.variables.templateVariables.large(t),this},a.prototype.prompt=function(t,e){if(this.viewmodel({prompt:t,text:e}),this.header(!1),this.closeButtonLabel(this.variables.templateVariables.closeButtonLabelPrompt()),this.saveButtonLabel(this.variables.templateVariables.saveButtonLabelPrompt()),this.variables.promptExternalTemplate===!1){var n="";void 0!==e&&(n+=this.variables.promptTextTemplate),n+=this.variables.promptInputTemplate,this.template(n,!1)}else this.template(this.variables.promptExternalTemplate,!0);return this},a.prototype.show=function(){var n=this;return t.when(this.templatePromise).then(function(){e.cleanNode(n.container[0]),n.factory.setupEvents(),e.applyBindings(n.variables,n.container[0]),n.container.modal("show")}),this},a.prototype.setDefaultOption=function(t,e){return a.VARIABLE_DEFAULTS[t]=e,this},a.prototype.save=function(t){return this.variables.callbacks.save=t,this},a.prototype.saveButton=function(t){return this.variables.templateVariables.saveButton(t),this},a.prototype.saveButtonLabel=function(t){return this.variables.templateVariables.saveButtonLabel(t),this},a.prototype.title=function(t){return this.variables.templateVariables.title(t),this},a.prototype.template=function(t,e){return"undefined"!=typeof e&&(this.variables.templateIsExternal=e),this.variables.template(t),this},a.prototype.viewmodel=function(t){return this.variables.viewmodel=t,this.undoRedoStack=i(this.variables.viewmodel),this},n.Modal=function(t){if(t===!1)return new a(void 0,{},{hidden:function(t){t.remove()}});if(n.Modal.prototype._singletonInstance)return l.call(n.Modal.prototype._singletonInstance),n.Modal.prototype._singletonInstance;var e=new a;return n.Modal.prototype._singletonInstance=e,e},n.Modal.prototype.setDefaultOption=function(t,e){a.VARIABLE_DEFAULTS[t]=e},n.Modal.prototype.extendDefaultOptions=function(e){t.extend(!0,a.VARIABLE_DEFAULTS,e)}}(s),function(e,n){"use strict";var a=function(t){this.instance=t,this.instance.templatePromise=this.setupTemplateContentPromise(),this.setupTemplateListener(this.instance)};a.prototype.insertTemplate=function(e){var n=l(this.instance.settings.body,this.instance.container),a=t(t.parseHTML(e));n.html(""),a.appendTo(n)},a.prototype.loadExternalUsingjQuery=function(e,n){var a=t.ajax({url:e});t.when(a).then(function(t){n.resolve(t)})},a.prototype.loadExternalUsingRequire=function(t,e){n(["text!"+t],function(t){e.resolve(t)})},a.prototype.setupTemplateContentPromise=function(){var e=this,n=t.Deferred();return t.when(n).then(function(t){e.insertTemplate(t)}),n},a.prototype.setupTemplateListener=function(t){var e=this;t.variables.template.subscribe(function(a){var o=t.variables.templateIsExternal;e.instance.templatePromise=e.setupTemplateContentPromise(),o?n instanceof jQuery?e.loadExternalUsingjQuery(a,e.instance.templatePromise):e.loadExternalUsingRequire(a,e.instance.templatePromise):e.instance.templatePromise.resolve(a)})},e.Template=a}(s,o);var l=function(e,n,a){if(e.nodeType)return t(e);if(e instanceof jQuery)return e;var o=t(e,n);if(0===o.length&&a!==!1)throw Error("Knockout-bootstrap-modal: Could not find element with selector '"+e+"'");return o},p=function(){var t=arguments[0];if(!u(t))return!1;var e=Array.prototype.slice.call(arguments);return e.shift(),t.apply(this,e)},u=function(t){return t instanceof Function};return s.Modal});