!function(t,e){"function"==typeof define&&define.amd?define(["jquery","knockout","bootstrap","text!knockout-bootstrap-modal-html","require","knockout-undomanager","knockout-mapping"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("knockout"),require("bootstrap"),require("text!knockout-bootstrap-modal-html"),require("require"),require("knockout-undomanager"),require("knockout-mapping")):t.KnockoutBootstrapModal=e(t.jQuery,t.ko,t.jQuery,t.KnockoutBootstrapModalHtml,t.jQuery,t.knockoutUndoManager,t.ko.mapping)}(this,function(t,e,n,o,i,a,r){if("undefined"==typeof s)var s={};!function(e){"use strict";var n=function(t,n){this.instance=t,this.initialize(n),this.initializeModal();new e.Template(this.instance)};n.prototype.createHidingPromise=function(){var e=this,n=t.Deferred();return t.when(n).then(function(){e.instance.hide()}),n},n.prototype.createContainerFromHtml=function(e){var n=t(e),o=t(this.instance.settings.appendContainerTo);if(0===o.length)throw Error("Knockout-bootstrap-modal: Could not find an element with selector '"+this.instance.settings.appendContainerTo+"' to append the modal container to.");return n.appendTo(o),n},n.prototype.evaluateContainerInput=function(t){return l(t)},n.prototype.initialize=function(t){if("undefined"!=typeof t)return this.setContainer(t);if("undefined"!=typeof o)return this.setContainer(this.createContainerFromHtml(o));throw Error("Knockout-bootstrap-modal: No valid container was given.")},n.prototype.initializeModal=function(){this.instance.container.modal({show:!1})},n.prototype.onModalHide=function(){if(this.instance.variables.saving===!1&&this.instance.undeRedoStack)for(var t=this.instance.undoRedoStack.undoCommand;t.enabled();)t.execute()},n.prototype.setContainer=function(t){var t=this.evaluateContainerInput(t);if(0===t.length)throw Error("Knockout-bootstrap-modal: Could not find container with selector "+t);return this.instance.container=t,t},n.prototype.setupEvents=function(){this.instance.container.on("hide.bs.modal",this.onModalHide.bind(this))},e.Factory=n}(s),function(n){"use strict";var o=function(e,i){this.container,this.settings=t.extend(o.DEFAULTS,i||{}),this.variables={},l.call(this),this.factory=new n.Factory(this,e)};o.DEFAULTS={appendContainerTo:"body",body:".modal-body"},o.VARIABLE_DEFAULTS={callbacks:{},closeClick:null,saveClick:null,saving:!1,templateIsExternal:!1,template:"<div></div>",templateVariables:{closeButton:!0,closeCross:!0,footer:!0,header:!0,large:!1,saveButton:!0,title:!1},viewmodel:{}};var i=function(){return c(this.variables.callbacks.close),this.hide(),!0},s=function(){this.variables.saving=!0;var t=this.factory.createHidingPromise();return u(this.variables.callbacks.save)?this.variables.callbacks.save.call(this,t,this.variables.viewmodel):t.resolve(!0),this.variables.saving=!1,!0},l=function(){var e=t.extend({},o.VARIABLE_DEFAULTS,{closeClick:i.bind(this),saveClick:s.bind(this)});r.fromJS(e,{copy:["saving","templateIsExternal"]},this.variables)};o.prototype.close=function(t){return this.variables.callbacks.close=t,this},o.prototype.closeButton=function(t){return this.variables.templateVariables.closeButton(t),this},o.prototype.closeCross=function(t){return this.variables.templateVariables.closeCross(t),this},o.prototype.hide=function(){return this.container.modal("hide"),this},o.prototype.large=function(t){return"undefined"==typeof t&&(t=!0),this.variables.templateVariables.large(t),this},o.prototype.show=function(){var n=this;return t.when(this.templatePromise).then(function(){e.cleanNode(n.container[0]),n.factory.setupEvents(),e.applyBindings(n.variables,n.container[0]),n.container.modal("show")}),this},o.prototype.save=function(t){return this.variables.callbacks.save=t,this},o.prototype.saveButton=function(t){return this.variables.templateVariables.saveButton(t),this},o.prototype.title=function(t){return this.variables.templateVariables.title(t),this},o.prototype.template=function(t,e){return"undefined"!=typeof e&&(this.variables.templateIsExternal=e),this.variables.template(t),this},o.prototype.viewmodel=function(t){return this.variables.viewmodel=t,this.undoRedoStack=a(this.variables.viewmodel),this},n.Modal=function(){if(n.Modal.prototype._singletonInstance)return l.call(n.Modal.prototype._singletonInstance),n.Modal.prototype._singletonInstance;var t=new o;return n.Modal.prototype._singletonInstance=t,t}}(s),function(e,n){"use strict";var o=function(t){this.instance=t,this.instance.templatePromise=this.setupTemplateContentPromise(),this.setupTemplateListener(this.instance)};o.prototype.insertTemplate=function(e){var n=l(this.instance.settings.body,this.instance.container),o=t(t.parseHTML(e));n.html(""),o.appendTo(n)},o.prototype.loadExternalUsingjQuery=function(e,n){var o=t.ajax({url:e});t.when(o).then(function(t){n.resolve(t)})},o.prototype.loadExternalUsingRequire=function(t,e){n(["text!"+t],function(t){e.resolve(t)})},o.prototype.setupTemplateContentPromise=function(){var e=this,n=t.Deferred();return t.when(n).then(function(t){e.insertTemplate(t)}),n},o.prototype.setupTemplateListener=function(t){var e=this;t.variables.template.subscribe(function(o){var i=t.variables.templateIsExternal;e.instance.templatePromise=e.setupTemplateContentPromise(),i?n instanceof jQuery?e.loadExternalUsingjQuery(o,e.instance.templatePromise):e.loadExternalUsingRequire(o,e.instance.templatePromise):e.instance.templatePromise.resolve(o)})},e.Template=o}(s,i);var l=function(e,n,o){if(e.nodeType)return t(e);if(e instanceof jQuery)return e;var i=t(e,n);if(0===i.length&&o!==!1)throw Error("Knockout-bootstrap-modal: Could not find element with selector '"+e+"'");return i},c=function(){var t=arguments[0];if(!u(t))return!1;var e=Array.prototype.slice.call(arguments);return e.shift(),t.apply(this,e)},u=function(t){return t instanceof Function};return s.Modal});